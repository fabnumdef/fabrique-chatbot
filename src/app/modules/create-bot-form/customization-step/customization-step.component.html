<div class="customization">
  <form [formGroup]="formGroup" *ngIf="formGroup">
    <h2>Quel est le nom de votre chatbot ?</h2>
    <mat-form-field appearance="outline">
      <input matInput
             formControlName="name"
             [placeholder]="'Roger, Bernadette, Hugo ...'"
             data-cy="ChatbotNameInput"
             maxlength="50"
             required/>
      <mat-error *ngIf="controls.name.hasError('required')">
        Vous n'avez pas saisi de nom pour votre chatbot.
      </mat-error>
      <mat-error *ngIf="controls.name.hasError('maxlength')">
        Le nom de votre chatbot ne doit pas dépasser 50 caractères.
      </mat-error>
    </mat-form-field>

    <mat-divider></mat-divider>

    <h2>Quel est l'icône de votre chatbot ?</h2>
    <div>
      Choisir l'icône qui vous convient dans la bibliothèque ci-dessous.
    </div>
    <div class="icons-wrapper" data-cy="PresetIcons">
      <div class="icon"
           *ngFor="let icon of icons"
           data-cy="PresetIcon"
           (click)="selectIcon(icon)">
        <img [src]="'assets/img/icons/' + icon" [alt]="'Proposition de logo: ' + icon">
      </div>
    </div>
    <div>
      Ou importer votre propre icône <span class="hint">(*format jpg ou png)</span>
    </div>
    <button mat-flat-button
            color="accent"
            *ngIf="!controls.icon.value; else iconFileWrapper"
            class="import-btn"
            data-cy="ImportIconBtn"
            (click)="iconUploader.click()">
      Importer une icône
    </button>
    <input hidden
           type="file"
           #iconUploader
           data-cy="ImportIconInput"
           (change)="uploadIcon($event)"
           [accept]="'.jpg, .png'"/>

    <ng-template #iconFileWrapper>
      <div class="icon-file-wrapper" data-cy="SelectedIconWrapper">
        <div>
          <div class="icon">
            <img [src]="imgPreview" *ngIf="imgPreview">
          </div>
          <div class="file-name" data-cy="IconName">
            {{ controls.icon?.value?.name }}
          </div>
        </div>
        <div>
          <button mat-stroked-button
                  color="accent"
                  data-cy="DeleteIconBtn"
                  (click)="resetIconFile()">
            Supprimer
          </button>
          <button mat-flat-button
                  color="accent"
                  data-cy="UpdateIconBtn"
                  (click)="iconUploader.click()">
            Mettre à jour
          </button>
        </div>
      </div>
    </ng-template>

    <mat-divider></mat-divider>

    <h2>Quelles sont vos couleurs ?</h2>
    <div class="color-picker-div" (click)="colorPickerPrimary.click()" data-cy="PrimaryPicker">
      <label>
        Choisir la couleur primaire (en-tête)
        <div>
          <input #colorPickerPrimary
                 class="colorpicker color-picker-icon"
                 maxlength="20"
                 [colorPicker]="controls.primaryColor.value"
                 [style.background]="controls.primaryColor.value"
                 (colorPickerChange)="controls.primaryColor.setValue($event)"/>
        </div>
      </label>
    </div>
    <div class="color-picker-div" (click)="colorPickerSecondary.click()" data-cy="SecondaryPicker">
      <label>
        Choisir la couleur secondaire (bas de page)
        <div>
          <input #colorPickerSecondary
                 class="colorpicker color-picker-icon"
                 maxlength="20"
                 [colorPicker]="controls.secondaryColor.value"
                 [style.background]="controls.secondaryColor.value"
                 (colorPickerChange)="controls.secondaryColor.setValue($event)"/>
        </div>
      </label>
    </div>
  </form>
</div>
<div class="preview">
  <app-chatbot-preview [chatbot]="formGroup.getRawValue()" [iconSrc]="imgPreview">
  </app-chatbot-preview>
</div>
